services:
    # Ferron container
    ferron:
        image: ferronserver/ferron:2
        ports:
            - "80:80"
            - "443:443"
        volumes:
            - "ferron-acme:/var/cache/ferron-acme"
            - "./ferron.kdl:/etc/ferron.kdl"
            - "ferron-sub-configs:/etc/ferron-proxy-manager/"
        restart: always

    backend:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: ferron-proxy-backend
        ports:
            - "8000:8000"
        volumes:
            - ferron-data:/app/data
            - "./ferron.kdl:/etc/ferron.kdl"
            - "ferron-sub-configs:/etc/ferron-proxy-manager/"
        environment:
            - DEBUG=${DEBUG:-false}
            - DATABASE_URL=${DATABASE_URL:-sqlite+aiosqlite:///./data/ferron.db}
            - DATABASE_ECHO=${DATABASE_ECHO:-false}
            - AUTH_SECRET_KEY=${AUTH_SECRET_KEY:?AUTH_SECRET_KEY is required in production}
        restart: always

volumes:
    ferron-acme:
    ferron-data:
    ferron-sub-configs:
